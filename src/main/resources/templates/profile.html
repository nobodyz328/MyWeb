<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸ªäººä¸»é¡µ - MySteamç¤¾åŒº</title>
  <style>
    .profile-banner { background: linear-gradient(90deg,#23262e 60%,#66c0f4 100%); border-radius: 16px; padding: 32px 40px; color: #fff; display: flex; align-items: center; gap: 32px; margin: 40px auto 32px auto; max-width: 900px; }
    .profile-avatar { width: 96px; height: 96px; border-radius: 50%; background: #1b2838; border: 3px solid #66c0f4; }
    .profile-info { flex: 1; }
    .profile-tabs { display: flex; gap: 32px; margin: 0 auto 24px auto; max-width: 900px; }
    .profile-tabs button { background: none; border: none; color: #66c0f4; font-size: 1.1rem; cursor: pointer; padding: 8px 24px; border-bottom: 2px solid transparent; transition: border 0.2s; }
    .profile-tabs .active { border-bottom: 2px solid #66c0f4; font-weight: bold; }
    .profile-content { background: #23262e; border-radius: 12px; box-shadow: 0 4px 24px rgba(63, 53, 53, 0.4); padding: 32px; max-width: 900px; margin: 0 auto; color: #fff; }
  </style>
</head>
<body class="steam-bg" style="background: linear-gradient(135deg, #1b2838 0%, #30415d 100%) fixed; min-height:100vh;">
  <div style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:-1;background:linear-gradient(135deg,#22304a 0%,#1b2838 100%);opacity:0.85;"></div>
  <button onclick="window.location.href='/blog/view'" style="position:fixed;top:24px;left:24px;z-index:1000;background:#23262e;color:#66c0f4;border:none;border-radius:8px;padding:10px 18px;font-size:1rem;cursor:pointer;box-shadow:0 2px 8px rgba(56,49,49,0.4);">ğŸ”™</button>
  <div class="profile-banner" id="profileBanner">
    <img id="profileAvatar" src="https://static.hdslb.com/images/member/noface.gif" class="profile-avatar">
    <div class="profile-info">
      <h2 id="profileUsername">ç”¨æˆ·å</h2>
      <div id="profileBio">ç®€ä»‹ï¼š</div>
      <div>
        å…³æ³¨ <b id="profileFollowing">0</b> | ç²‰ä¸ <b id="profileFollowers">0</b> | è·èµ <b id="profileLiked">0</b>
      </div>
    </div>
    <button class="steam-btn" id="logoutBtn" style="margin-left:auto;">é€€å‡ºç™»å½•</button>
  </div>
  <div class="profile-tabs">
    <button class="active" id="tabPosts">æˆ‘çš„å¸–å­</button>
    <button id="tabCollects">æ”¶è—</button>
    <button id="tabFollows">å…³æ³¨</button>
    <button id="tabSettings">è®¾ç½®</button>
  </div>
  <div class="profile-content" id="profileContent">
    <!-- æˆ‘çš„å¸–å­tabå†…å®¹ -->
    <div id="postsTabContent">
      <button class="steam-btn" style="margin-bottom:18px;" onclick="window.location.href='/blog/posts/new'">+ åˆ›å»ºå¸–å­</button>
      <div id="myPostsList">è¿™é‡Œæ˜¾ç¤ºæˆ‘çš„å¸–å­</div>
    </div>
    <!-- æ”¶è—tabå†…å®¹ -->
    <div id="collectsTabContent" style="display:none;">è¿™é‡Œæ˜¾ç¤ºæ”¶è—çš„å¸–å­</div>
    <!-- å…³æ³¨tabå†…å®¹ -->
    <div id="followsTabContent" style="display:none;">è¿™é‡Œæ˜¾ç¤ºå…³æ³¨çš„ç”¨æˆ·</div>
    <!-- è®¾ç½®tabå†…å®¹ -->
    <div id="settingsTabContent" style="display:none;">
      <div id="emailBindSection" style="background:#23262e; border-radius:8px; padding:24px; box-shadow:0 2px 8px #0006;max-width:400px;">
        <h3>ç»‘å®šé‚®ç®±</h3>
        <div id="emailBindStatus"></div>
        <form id="emailBindForm" style="display:flex;gap:12px;align-items:center;">
          <input type="email" id="bindEmailInput" placeholder="è¾“å…¥é‚®ç®±" style="flex:1;padding:8px;border-radius:6px;border:1px solid #66c0f4;background:#1b2838;color:#fff;">
          <input type="text" id="bindEmailCode" placeholder="éªŒè¯ç " style="width:100px;padding:8px;border-radius:6px;border:1px solid #66c0f4;background:#1b2838;color:#fff;">
          <button type="button" id="getBindCodeBtn" class="steam-btn" style="padding:8px 12px;">è·å–éªŒè¯ç </button>
          <button type="submit" class="steam-btn" style="padding:8px 12px;">ç»‘å®šé‚®ç®±</button>
        </form>
      </div>
    </div>
  </div>
  <script>
    // è·å–å½“å‰ç™»å½•ç”¨æˆ·ID
    const userId = localStorage.getItem('userId');
    if (userId) {
      fetch('/blog/users/' + userId + '/profile')
        .then(res => res.json())
        .then(data => {
          document.getElementById('profileUsername').innerText = data.username;
          document.getElementById('profileBio').innerText = 'ç®€ä»‹ï¼š' + (data.bio || '');
          document.getElementById('profileFollowing').innerText = data.followingCount;
          document.getElementById('profileFollowers').innerText = data.followersCount;
          document.getElementById('profileLiked').innerText = data.likedCount;
          if(data.avatarUrl) document.getElementById('profileAvatar').src = data.avatarUrl;
        });
    }
    // é€€å‡ºç™»å½•
    document.getElementById('logoutBtn').onclick = function() {
      localStorage.removeItem('userId');
      window.location.href = '/blog/login';
    };
    // Tabåˆ‡æ¢é€»è¾‘
    const tabPosts = document.getElementById('tabPosts');
    const tabCollects = document.getElementById('tabCollects');
    const tabFollows = document.getElementById('tabFollows');
    const tabSettings = document.getElementById('tabSettings');
    const postsTabContent = document.getElementById('postsTabContent');
    const collectsTabContent = document.getElementById('collectsTabContent');
    const followsTabContent = document.getElementById('followsTabContent');
    const settingsTabContent = document.getElementById('settingsTabContent');
    const profileContent = document.getElementById('profileContent');
    tabPosts.onclick = () => {
      setActive(tabPosts);
      postsTabContent.style.display = '';
      collectsTabContent.style.display = 'none';
      followsTabContent.style.display = 'none';
      settingsTabContent.style.display = 'none';
      loadMyPosts();
    };
    tabCollects.onclick = () => {
      setActive(tabCollects);
      postsTabContent.style.display = 'none';
      collectsTabContent.style.display = '';
      followsTabContent.style.display = 'none';
      settingsTabContent.style.display = 'none';
    };
    tabFollows.onclick = () => {
      setActive(tabFollows);
      postsTabContent.style.display = 'none';
      collectsTabContent.style.display = 'none';
      followsTabContent.style.display = '';
      settingsTabContent.style.display = 'none';
    };
    tabSettings.onclick = () => {
      setActive(tabSettings);
      postsTabContent.style.display = 'none';
      collectsTabContent.style.display = 'none';
      followsTabContent.style.display = 'none';
      settingsTabContent.style.display = '';
    };
    function setActive(tab) {
      [tabPosts, tabCollects, tabFollows, tabSettings].forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
    }
    // é‚®ç®±ç»‘å®šåŠŸèƒ½
    const emailBindForm = document.getElementById('emailBindForm');
    const getBindCodeBtn = document.getElementById('getBindCodeBtn');
    const bindEmailInput = document.getElementById('bindEmailInput');
    const bindEmailCode = document.getElementById('bindEmailCode');
    const emailBindStatus = document.getElementById('emailBindStatus');
    getBindCodeBtn.onclick = function() {
      const email = bindEmailInput.value;
      const userId = localStorage.getItem('userId');
      if (!email) { emailBindStatus.innerText = 'è¯·è¾“å…¥é‚®ç®±'; return; }
      fetch(`/users/${userId}/bind-email/code?email=` + encodeURIComponent(email), {method: 'POST'})
        .then(res => { if(res.ok) emailBindStatus.innerText = 'éªŒè¯ç å·²å‘é€åˆ°é‚®ç®±'; });
    };
    emailBindForm.onsubmit = function(e) {
      e.preventDefault();
      const email = bindEmailInput.value;
      const code = bindEmailCode.value;
      const userId = localStorage.getItem('userId');
      fetch(`/users/${userId}/bind-email`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({email, code})
      }).then(res => {
        if(res.ok) emailBindStatus.innerText = 'é‚®ç®±ç»‘å®šæˆåŠŸ';
        else emailBindStatus.innerText = 'ç»‘å®šå¤±è´¥ï¼Œè¯·æ£€æŸ¥éªŒè¯ç ';
      });
    };
    // æˆ‘çš„å¸–å­tabå†…å®¹å¼‚æ­¥åŠ è½½
    function loadMyPosts() {
      const userId = localStorage.getItem('userId');
      if (!userId) return;
      fetch('/blog/posts/mine?userId=' + userId)
        .then(res => res.json())
        .then(posts => {
          const list = document.getElementById('myPostsList');
          if (!posts || posts.length === 0) {
            list.innerHTML = '<div style="color:#c7d5e0;">æš‚æ— å¸–å­</div>';
            return;
          }
          list.innerHTML = posts.map(post => `
            <div class="post-card">
              <div class="post-title">${post.title}</div>
              <div class="post-meta">${post.createdAt ? post.createdAt.replace('T',' ').slice(0,16) : ''} | ${post.likeCount || 0} èµ | ${post.collectCount || 0} æ”¶è—</div>
              <div class="post-actions">
                <button onclick="editPost(${post.id})">ç¼–è¾‘</button>
                <button onclick="deletePost(${post.id})">åˆ é™¤</button>
              </div>
            </div>
          `).join('');
        });
    }
    function editPost(id) {
      window.location.href = `/blog/posts/edit/${id}`;
    }
    function deletePost(id) {
      if (confirm('ç¡®å®šè¦åˆ é™¤è¯¥å¸–å­å—ï¼Ÿ')) {
        fetch(`/blog/api/posts/${id}`, { method: 'DELETE' })
          .then(res => {
            if (res.ok) loadMyPosts();
            else alert('åˆ é™¤å¤±è´¥');
          });
      }
    }
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æˆ‘çš„å¸–å­
    loadMyPosts();
  </script>
</body>
</html> 