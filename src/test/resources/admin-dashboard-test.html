<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理员面板测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid mt-4">
        <h2>管理员面板API测试</h2>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>API测试</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-2" onclick="testStatistics()">测试系统统计</button>
                        <button class="btn btn-info mb-2" onclick="testAuditLogs()">测试审计日志</button>
                        <button class="btn btn-warning mb-2" onclick="testSecurityEvents()">测试安全事件</button>
                        <button class="btn btn-success mb-2" onclick="testSecurityTrends()">测试安全趋势</button>
                        <button class="btn btn-danger mb-2" onclick="testRealtimeAlerts()">测试实时告警</button>
                        <button class="btn btn-secondary mb-2" onclick="testHotIps()">测试热点IP</button>
                        <button class="btn btn-dark mb-2" onclick="testUserBehavior()">测试用户行为</button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>测试结果</h5>
                    </div>
                    <div class="card-body">
                        <pre id="test-results" style="max-height: 400px; overflow-y: auto;"></pre>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>模拟数据显示</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title">今日审计日志</h5>
                                        <h3 class="text-primary" id="today-audit-logs">0</h3>
                                        <small class="text-muted">失败: <span class="text-danger" id="today-failures">0</span></small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title">今日登录次数</h5>
                                        <h3 class="text-info" id="today-logins">0</h3>
                                        <small class="text-muted">失败: <span class="text-danger" id="today-login-failures">0</span></small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title">安全事件</h5>
                                        <h3 class="text-warning" id="today-security-events">0</h3>
                                        <small class="text-muted">高危: <span class="text-danger" id="high-risk-events">0</span></small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title">在线用户</h5>
                                        <h3 class="text-success" id="online-users">0</h3>
                                        <small class="text-muted">总用户: <span id="total-users">0</span></small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = '/blog/admin/api';
        
        function logResult(title, data) {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            results.textContent += `[${timestamp}] ${title}:\n${JSON.stringify(data, null, 2)}\n\n`;
            results.scrollTop = results.scrollHeight;
        }
        
        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }
        
        async function testStatistics() {
            try {
                const response = await fetch(`${API_BASE}/statistics`);
                const data = await response.json();
                logResult('系统统计', data);
                
                // 更新显示
                updateElement('today-audit-logs', data.todayAuditLogs || 0);
                updateElement('today-failures', data.todayFailures || 0);
                updateElement('today-logins', data.todayLogins || 0);
                updateElement('today-login-failures', data.todayLoginFailures || 0);
                updateElement('today-security-events', data.todaySecurityEvents || 0);
                updateElement('high-risk-events', data.highRiskEvents || 0);
                updateElement('online-users', data.activeUsers || 0);
                updateElement('total-users', data.totalUsers || 0);
                
            } catch (error) {
                logResult('系统统计错误', error.message);
            }
        }
        
        async function testAuditLogs() {
            try {
                const response = await fetch(`${API_BASE}/audit-logs?size=5`);
                const data = await response.json();
                logResult('审计日志', data);
            } catch (error) {
                logResult('审计日志错误', error.message);
            }
        }
        
        async function testSecurityEvents() {
            try {
                const response = await fetch(`${API_BASE}/security-events?size=5`);
                const data = await response.json();
                logResult('安全事件', data);
            } catch (error) {
                logResult('安全事件错误', error.message);
            }
        }
        
        async function testSecurityTrends() {
            try {
                const response = await fetch(`${API_BASE}/security-trends?days=7`);
                const data = await response.json();
                logResult('安全趋势', data);
            } catch (error) {
                logResult('安全趋势错误', error.message);
            }
        }
        
        async function testRealtimeAlerts() {
            try {
                const response = await fetch(`${API_BASE}/realtime-alerts`);
                const data = await response.json();
                logResult('实时告警', data);
            } catch (error) {
                logResult('实时告警错误', error.message);
            }
        }
        
        async function testHotIps() {
            try {
                const response = await fetch(`${API_BASE}/hot-ips`);
                const data = await response.json();
                logResult('热点IP', data);
            } catch (error) {
                logResult('热点IP错误', error.message);
            }
        }
        
        async function testUserBehavior() {
            try {
                const response = await fetch(`${API_BASE}/user-behavior`);
                const data = await response.json();
                logResult('用户行为', data);
            } catch (error) {
                logResult('用户行为错误', error.message);
            }
        }
        
        // 页面加载时自动测试统计数据
        document.addEventListener('DOMContentLoaded', function() {
            testStatistics();
        });
    </script>
</body>
</html>